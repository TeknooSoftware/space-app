# HTTP: redirect all traffic to HTTPS
{
        skip_install_trust

        {$CADDY_GLOBAL_OPTIONS}

        frankenphp {
                {$FRANKENPHP_CONFIG}
        }
}

{$CADDY_EXTRA_CONFIG}

http://localhost {
  redir https://{host}{uri} 301
}

https://localhost {
    tls internal

    root * /var/www/space/public

    encode zstd gzip

    mercure {
        publisher_jwt {env.MERCURE_PUBLISHER_JWT_KEY} {env.MERCURE_PUBLISHER_JWT_ALG}
        subscriber_jwt {env.MERCURE_SUBSCRIBER_JWT_KEY} {env.MERCURE_SUBSCRIBER_JWT_ALG}

        anonymous
        subscriptions
        cors_origins https://localhost http://localhost
    }

    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Strict-Transport-Security "max-age=3600"
        Access-Control-Allow-Origin "*"
    }

    php_server {

    }
}

# As an alternative to editing the above site block, you can add your own site
# block files in the Caddyfile.d directory, and they will be included as long
# as they use the .caddyfile extension.

import Caddyfile.d/*.caddyfile

